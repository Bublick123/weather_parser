<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Parser | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Weather Parser</a>
            <div class="navbar-nav">
                <a class="nav-link active" aria-current="page" href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a class="nav-link" href="/results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
                <a class="nav-link" href="/monitor">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
                <a class="nav-link" href="/forecast">–ü—Ä–æ–≥–Ω–æ–∑</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold mb-3" style="color: #2d3748;">üå§Ô∏è Weather Parser</h1>
            <p class="lead text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–æ–º –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
        </div>

        <div class="row g-4 justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-4">üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞</h5>
                        <p class="text-muted mb-4">–ó–∞–ø—É—Å—Ç–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ–≥–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤</p>
                        <button class="btn btn-success btn-lg px-5" onclick="triggerDag('async_weather_parser_dag')">
                            ‚ö° –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ–≥–æ–¥—ã
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-10">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">üìå <strong>DAG:</strong> <code>async_weather_parser_dag</code></li>
                            <li class="mb-2">üåç <strong>–ì–æ—Ä–æ–¥–∞:</strong> –ß–µ–ª—è–±–∏–Ω—Å–∫, –ò–∂–µ–≤—Å–∫, –ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥,
                                –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, –ì—Ä–æ–Ω–∏–Ω–≥–µ–Ω</li>
                            <li class="mb-2">‚ö° <strong>–¢–∏–ø:</strong> –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (–±—ã—Å—Ç—Ä—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π)</li>
                            <li class="mb-0">üìä –õ–æ–≥–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Airflow UI –∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ¬´–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥¬ª</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="alert-area" class="mt-4" style="display:none;">
            <div class="alert" role="alert"></div>
        </div>
    </div>

    <script>
        async function triggerDag(dagId) {
            setAlert('info', `–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–¥–∞—á—É ${dagId}...`);
            try {
                const resp = await fetch(`/trigger/${dagId}`, { method: 'POST' });
                const data = await resp.json();
                if (!resp.ok || data.error) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞');
                }
                setAlert('success', `DAG ${dagId} –∑–∞–ø—É—â–µ–Ω. run_id: ${data.response?.dag_run_id || '—Å–º. Airflow'}`);
            } catch (err) {
                setAlert('danger', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å ${dagId}: ${err.message}`);
            }
        }

        function setAlert(type, message) {
            const area = document.getElementById('alert-area');
            const alert = area.querySelector('.alert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            area.style.display = 'block';
        }
    </script>
</body>

</html>