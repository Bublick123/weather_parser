<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Parser | –ü—Ä–æ–≥–Ω–æ–∑</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Weather Parser</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a class="nav-link" href="/results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
            <a class="nav-link" href="/monitor">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
            <a class="nav-link active" aria-current="page" href="/forecast">–ü—Ä–æ–≥–Ω–æ–∑</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold mb-3" style="color: #2d3748;">üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</h1>
        <p class="lead text-muted">ML –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö</p>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form id="forecast-form" onsubmit="getForecast(event)">
                        <div class="mb-3">
                            <label for="city" class="form-label">–ì–æ—Ä–æ–¥</label>
                            <input type="text" class="form-control" id="city" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Moscow" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="loading" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <p class="mt-2 text-muted">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ...</p>
    </div>

    <div id="result-area" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow border-0">
                    <div class="card-header bg-primary text-white text-center py-3">
                        <h4 class="mb-0" id="res-city">–ú–æ—Å–∫–≤–∞</h4>
                    </div>
                    <div class="card-body p-4">
                        <div class="row text-center mb-4">
                            <div class="col-6 border-end">
                                <p class="text-muted mb-1">–°–µ–π—á–∞—Å</p>
                                <h2 class="fw-bold" id="res-current">--¬∞C</h2>
                            </div>
                            <div class="col-6">
                                <p class="text-muted mb-1">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∑–∞–≤—Ç—Ä–∞</p>
                                <h2 class="fw-bold text-primary" id="res-prediction">--¬∞C</h2>
                            </div>
                        </div>
                        
                        <div class="alert alert-light border" role="alert">
                            <h5 class="alert-heading">üìä –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞</h5>
                            <p class="mb-0" id="res-trend">--</p>
                            <hr>
                            <p class="mb-0 small text-muted" id="res-pattern">--</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="error-area" class="alert alert-danger mt-4" style="display: none;"></div>
</div>

<script>
async function getForecast(event) {
    event.preventDefault();
    const city = document.getElementById('city').value;
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('result-area').style.display = 'none';
    document.getElementById('error-area').style.display = 'none';
    
    try {
        const resp = await fetch(`/api/forecast?city=${encodeURIComponent(city)}`);
        const data = await resp.json();
        
        if (!resp.ok) {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞');
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        document.getElementById('res-city').textContent = data.city;
        document.getElementById('res-current').textContent = `${data.current_temp}¬∞C`;
        document.getElementById('res-prediction').textContent = `${data.prediction}¬∞C`;
        
        const trendDir = data.trend.direction === 'up' ? 'üìà –ü–æ—Ç–µ–ø–ª–µ–Ω–∏–µ' : 
                        (data.trend.direction === 'down' ? 'üìâ –ü–æ—Ö–æ–ª–æ–¥–∞–Ω–∏–µ' : '‚û°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–æ');
        document.getElementById('res-trend').textContent = `${trendDir} (–∏–∑–º–µ–Ω–µ–Ω–∏–µ ${data.trend.change > 0 ? '+' : ''}${data.trend.change}¬∞C)`;
        document.getElementById('res-pattern').textContent = `–•–∞—Ä–∞–∫—Ç–µ—Ä –ø–æ–≥–æ–¥—ã: ${data.pattern}`;
        
        document.getElementById('result-area').style.display = 'block';
    } catch (err) {
        const errDiv = document.getElementById('error-area');
        errDiv.textContent = err.message;
        errDiv.style.display = 'block';
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}
</script>
</body>
</html>
